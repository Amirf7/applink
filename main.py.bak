# import requests


from rubika import Socket, Bot
from rubika.filters import filters
import requests
import os

bot = Socket("gqgrkyhjlzmmcgwweaveutjcvlefvkgo")
sender = Bot("app", "gqgrkyhjlzmmcgwweaveutjcvlefvkgo")


@bot.handler(filters.PV, filters.text)
def handler(message):
    # message.show()
    p_des = open("caption.txt", "r").read()
    C_id = open("guid.txt", "r").read()
    subs = open("subscription.txt", "r").read()
    user_id = message.data.object_guid
    msg_text = message.data.message.text
    if user_id in subs:
        if "http://" in msg_text or "https://" in msg_text:
            message.reply("ğŸ’¯ Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...")
            url = message.data.message.text

            # start Downloading File

            message.reply("ğŸ”¸ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø±ÙˆØ¹ Ø´Ø¯...")
            r = requests.get(url, allow_redirects=True)
            file_name = url.split("/")
            file_name = file_name[len(file_name) - 1]

            # Saving File

            open(file_name, 'wb').write(r.content)
            message.reply("âœ… ÙØ§ÛŒÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!")

            # start Uploading File

            message.reply("ğŸ”¸ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø±ÙˆØ¹ Ø´Ø¯...")

            sender.sendDocument(C_id,
                                f"./{ file_name }", caption=f"{p_des}")

            message.reply("âœ… ÙØ§ÛŒÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯!")
            os.remove(file_name)
        if "!des" in msg_text:
            des = msg_text.replace("!des ", "")
            des_file = open("caption.txt", "w")
            des_file.write(des, chr="")
            message.reply("âœ… Ú©Ù¾Ø´Ù† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ø±Ø¨Ø§Øª Ø«Ø¨Øª Ø´Ø¯!")

        if "!id" in msg_text:
            id = msg_text.replace("!id ", "")
            guid = sender.getInfoByUsername(
                f"{id}")["data"]["channel"]["channel_guid"]
            id_file = open("guid.txt", "w")
            id_file.write(guid)
            sender.join(guid)
            message.reply("âœ… Ø±Ø¨Ø§Øª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ Ø¹Ø¶Ùˆ Ø´Ø¯ØŒ Ù„Ø·ÙØ§ Ø§Ø¯Ù…ÛŒÙ†Ø´ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø¹Ø¯ Ù„ÛŒÙ†Ú©ØªÙˆÙ† Ø±Ùˆ Ø¨ÙØ±Ø³ØªÛŒØ¯")

        if "!id @" in msg_text:
            id = msg_text.replace("!id @", "")
            guid = sender.getInfoByUsername(
                f"{id}")["data"]["channel"]["channel_guid"]
            id_file = open("guid.txt", "w")
            id_file.write(guid)
            sender.join(guid)
            message.reply("âœ… Ø±Ø¨Ø§Øª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ Ø¹Ø¶Ùˆ Ø´Ø¯ØŒ Ù„Ø·ÙØ§ Ø§Ø¯Ù…ÛŒÙ†Ø´ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø¹Ø¯ Ù„ÛŒÙ†Ú©ØªÙˆÙ† Ø±Ùˆ Ø¨ÙØ±Ø³ØªÛŒØ¯")

        if msg_text == "!help":
            message.reply(
                "â‰ï¸ Ø±Ø¨Ø§Øª Ú†Ø¬ÙˆØ±ÛŒ Ú©Ø§Ø± Ù…ÛŒÚ©Ù†Ù‡ØŸ\n\nğŸŒ€ !id [ Channel GUID ]\nğŸŒ€ !des [ Post Caption ]\n\nâ­•ï¸ ØªÙˆØ¬Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯ Ø±Ø¨Ø§Øª Ø­ØªÙ…Ø§ ØªÙˆÛŒ Ú†Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§Ø´Ù‡ ( Ø¨Ø±Ø§ÛŒ Ø¹Ø¶ÙˆÛŒØª Ø±Ø¨Ø§Øª ØªÙˆÛŒ Ú†Ù†Ù„ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø¢ÛŒØ¯ÛŒ Ú†Ù†Ù„Ùˆ Ø¨Ø¯ÛŒØ¯ )\n\nâ­•ï¸ Ø¢Ù¾Ù„ÙˆØ¯ Ø¯Ø³ØªÙˆØ± Ø®Ø§ØµÛŒ Ù†Ø¯Ø§Ø±Ù‡ØŒ ÙÙ‚Ø· Ø¨Ø§ÛŒØ¯ Ù„ÛŒÙ†Ú© ÙØ§ÛŒÙ„Ùˆ Ø¨Ù‡ Ø¨Ø§Øª Ø¨Ø¯ÛŒØ¯.\n\nğŸ’¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ùˆ Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© => @Karbala713")

        if user_id == "u0BqaGn0618f94c9434646d5195f1ae1":
            if "!add @" in msg_text:
                id = msg_text.replace("!add @", "")
                guid = sender.getInfoByUsername(
                    f"{id}")["data"]["user"]["user_guid"]
                sub_file = open("subscription.txt", "a")
                sub_file.write(f"\n{guid}")
                message.reply("âœ… Ø¢ÛŒØ¯ÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ø±Ø¨Ø§Øª Ø«Ø¨Øª Ø´Ø¯!")
                sender.sendMessage(
                    guid, "âœ… Ø´Ù…Ø§ Ø¯Ø± Ø±Ø¨Ø§Øª Ø§Ø¯Ù…ÛŒÙ† Ø´Ø¯ÛŒØ¯ØŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªÙˆØ±Ø§Øª !help Ø±Ùˆ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯!")
    else:
        message.reply("""
        ğŸ”– â• Ø¢Ù¾Ù„ÙˆØ¯Ø± ÙØ§ÛŒÙ„ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù„ÛŒÙ†Ú© ! 
 
 ğŸ”¹ | Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ù„Ø·ÙØ§ 
 Ø§Ø´ØªØ±Ø§Ú© Ø®ÙˆØ¯ Ø±Ø§ ØªÙ‡ÛŒÙ‡ Ú©Ù†ÛŒØ¯ . 
 
 â€¢ Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© ÛŒÚ© Ù…Ø§Ù‡Ù‡ :
 | P'v : @Karbala713 """)
            